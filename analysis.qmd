---
title: Analysis
description: Here we provide a detailed analysis using more sophisticated statistics techniques.
toc: true
draft: false
---

![](https://habitatbroward.org/wp-content/uploads/2020/01/10-Benefits-Showing-Why-Education-Is-Important-to-Our-Society.jpg)

### Section 1: Analysis of Education Statistics

Driven by the increasing interest in global education disparities, our team has decided to explore the educational landscape across various countries around the world. Education is a cornerstone of societal development, and by examining comprehensive datasets (please see the data tab to read more about our datasets), we aim to uncover the factors that contribute to education outcomes and identify disparities that may hinder equitable access to quality education. Our project seeks to provide insights that not can potentially inform policymakers, educators, and stakeholders about the key elements influencing educational success. 

Our project begins with section 1, where we will identify educational trends by the continent and attempt to answer ***why*** these country's are the way they are.

In section 2, we will model our data with a linear regression model and uncover insights that are harder to identify on the surface

```{r}
#| label: libraries
#| echo: false
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(tidymodels))
suppressPackageStartupMessages(library(broom))
suppressPackageStartupMessages(library(scales)) # for the label_comma() function
suppressPackageStartupMessages(library(patchwork))
```

```{r}
#| label: data import
#| echo: false

data <- read_csv('dataset/educ.csv')
continent <- read_csv('dataset/continents2.csv')
pisa <- read_csv('dataset/pisa-scores-by-country-2024.csv')
literacy <- read_csv('dataset/literacy.csv')
```

```{r}
#| label: data cleaning
#| echo: false

# clean literacy
literacy_clean <- literacy |>
  filter(Age == '15+', Gender == 'total') |>
  group_by(Country) |>
  summarize(mean_literacy_rate = mean(`Literacy rate`, na.rm = TRUE))

literacy_clean <- literacy_clean |>
  rename(
    country = Country
  )

```

```{r}
#| label: data cleaning2
#| echo: false

# rename columns to make it easier to merge
continent <- continent |>
  rename(
    country = name,
    sub_region = `sub-region`
  )
```

```{r}
#| label: data merging
#| echo: false

# merge the data
merged_data <- merge(data, continent, by = "country")
merged_data2 <- merge(merged_data, pisa, by = "country", all.x = TRUE)
merged_data3 <- merge(continent, literacy_clean, by = "country")
```

### Section 1.1: PISA Scores and Literacy Rates

The first step to understanding economic disparties is to get a general understanding of what parts of the world generally tend to have better education than others. There are multiple ways of measuring this, but reliable way to measure this is with PISA scores and literacy rates. Both of these metrics serve as standardized bench marks for the whole world!

```{r}
#| label: PISA
#| echo: false

continent_pisa <- merged_data2 |>
  group_by(region) |>
  summarise(overallpisa2022 = mean(OverallPisaScore2022, na.rm = TRUE)) |>
  ggplot(aes(x = region, y = overallpisa2022, fill = region)) + geom_col()

continent_pisa
```


```{r}
#| label: literacy
#| echo: false
continent_literacy <- merged_data3 |>
  filter(region != "Americas") |>
  group_by(region) |>
  summarise(literacy = mean(mean_literacy_rate, na.rm = TRUE)) |>
  ggplot(aes(x = region, y = literacy, fill = region)) + geom_col()

continent_literacy
```

```{r}
#| label: pisa facet
#| echo: false
#| 
americas_pisa_long <- merged_data2 %>%
  group_by(country) %>%
  summarise(
    pisa_overall_mean = mean(OverallPisaScore2022, na.rm = TRUE),
    pisa_math_mean = mean(PISAScoresMathScore2022, na.rm = TRUE), # Assuming you meant Math Score here
    pisa_science_mean = mean(PISAScoresScienceScore2022, na.rm = TRUE),
    pisa_reading_mean = mean(PISAScoresReadingScore2022, na.rm = TRUE),
    region = region
  ) %>%
  pivot_longer(
    cols = starts_with("pisa_"),
    names_to = "score_type",
    values_to = "score"
  ) %>%
  mutate(score_type = factor(score_type, levels = c("pisa_overall_mean", "pisa_math_mean", "pisa_science_mean", "pisa_reading_mean")))

# Creating the plot
americas_pisa_plot <- americas_pisa_long %>%
  ggplot(aes(x = country, y = score, fill = score_type)) + 
  geom_col(position = "dodge") + 
  scale_y_continuous(labels = label_comma()) + 
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 7)) +
  labs(y = "PISA Score", x = "Country", fill = "Score Type") +
  scale_fill_brewer(palette = "Pastel1") +
  facet_wrap(~ region, scales = "free_x") 

americas_pisa_plot

```

It is clear that in terms of PISA scores, Oceania and Europe perform the best, while Africa performed the worst, and in terms of literacy rate, all of the continents performed relatively equally while Africa performed the worst again. Now that you have a general understanding of where education is better and where education is worse, we can now get into more specific statistics.

### Section 1.2: Percentage of People who did not Complete Primary School

The next step of analyzing education around the world was to simply look at the percentage of (i) children and young people aged 3-5 years above primary school graduation age and (ii) young people aged 15-24, who have completed primary school.

```{r}
#| label: priary school completion 3-5
#| echo: false

continent_pisa2 <- merged_data |>
  group_by(region, year) |>
  summarise(complete_prim = mean(comp_prim_v2_m, na.rm = TRUE)) |>
  ggplot(aes(x = year, y = complete_prim, color = region)) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Primary School Completion Rate for People aged 3-5 years above primary school"
  )

continent_pisa2
```

```{r}
#| label: primary school completion 20-24
#| echo: false

continent_pisa2 <- merged_data |>
  group_by(region, year) |>
  summarise(complete_prim = mean(comp_prim_1524_m, na.rm = TRUE)) |>
  ggplot(aes(x = year, y = complete_prim, color = region)) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Primary School Completion Rate for ages 15-24"
  )

continent_pisa2
```
As you can see, Europe (while it has a lot of missing data), consistently ranks significantly higher than all of the other continents, while North America, South America, and Asia rank below Europe but higher than Africa. However, if we take a deeper look into the sub regions of Africa, we find some intersting outcomes.

```{r}
#| label: north africa primary completion
#| echo: false

northern_africa_mean_completion <- merged_data |>
  filter(sub_region %in% c('Northern Africa')) |>
  group_by(iso_code) |>
  summarise(mean_primary_completion_rate = mean(comp_prim_v2_m, na.rm = TRUE),
            percent_people_not_in_primary_school = mean(eduout_upsec_m, na.rm = TRUE),
            mean_educ_years_20_24 = mean(eduyears_2024_m, na.rm = TRUE),
            attend_higher_education = mean(attend_higher_1822_m, na.rm = TRUE),
            number_complete_prim_1524 = mean(comp_prim_1524_no, na.rm = TRUE),
            count = n()
            ) |>
  ggplot(aes(x = iso_code, y = mean_primary_completion_rate, fill = iso_code)) +
    geom_col() +ylim(c(0,1)) + theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
northern_africa_mean_completion
```
```{r}
#| label: sub-saharan africa primary school completion
#| echo: false

subsaharan_africa_mean_completion <- merged_data |>
  filter(sub_region %in% c('Sub-Saharan Africa')) |>
  group_by(iso_code) |>
  summarise(mean_primary_completion_rate = mean(comp_prim_v2_m, na.rm = TRUE),
            percent_people_not_in_primary_school = mean(eduout_upsec_m, na.rm = TRUE),
            mean_educ_years_20_24 = mean(eduyears_2024_m, na.rm = TRUE),
            attend_higher_education = mean(attend_higher_1822_m, na.rm = TRUE),
            number_complete_prim_1524 = mean(comp_prim_1524_no, na.rm = TRUE),
            count = n()
            ) |>
  ggplot(aes(x = iso_code, y = mean_primary_completion_rate)) +
    geom_col() +ylim(c(0,1)) + theme(axis.text.x = element_text(angle = 60, hjust = 1))
subsaharan_africa_mean_completion
```
As you can see, when looking at the % of people who finish primary school, the percentages are significantly lower for the sub-saharan African countries compared to the Northern African countries. It seems like Sub-Saharan Africa may be the reason Africa shows up so low in many of the plots in the first section. In fact, Northern Africa seems to be on par in terms of primary school completion rate when compared to the rest of the continents in the world, but Sub-Sahara Africa does not seem to be on par. This difference in regions suggests that much attention should actually be directed towards Sub-Saharan Africa rather than Africa as a whole.

The good news is that all countries seem to have a slow yet steady increase in their primary school completion rate which is great to see. 

The next step is to analyze the mean years of education of each region.

### Section 1.3: Years of Edcuation

After just two sections, it seems that there is a trend: Europe tends to have the "best education" while Africa seems to have "the worst education." We will now explore college attendane as another measure of education.

```{r}
#| label: mean years of education
#| echo: false

mean_educ <- merged_data |>
  group_by(region, year) |>
  summarise(mean_educ_years_20_24 = mean(eduyears_2024_m, na.rm = TRUE)) |>
  ggplot(aes(x = year, y = mean_educ_years_20_24, color = region)) +
  geom_smooth(method = "loess", se = FALSE) +
  labs(
    title = "Mean Years of Education for 20-24 Year Olds"
  )

mean_educ
```

This graph shows a similar result to the other graphs: Africa again ranks as the lowest. However, there are many reasons why this may be the case. For example, if we look mean years of education in rural areas vs. mean years of education in urban areas, we see that Africa has the largest descrpency in this area.

```{r}
#| label: rural vs urban for mean years of education
#| echo: false

grouped7 <- merged_data |>
  group_by(region, Location) |>
  summarise(
    mean_educ_years_20_24 = mean(eduyears_2024_m, na.rm = TRUE),
    count = n()
  ) |>
  ggplot(
    aes(x = Location, y = mean_educ_years_20_24, fill = Location) 
  )+geom_col() +
  facet_wrap(~ region, scales = "free_x") 

grouped7
```

This large discrepency in specifically Africa is so large that it could be bringing Africa down in total mean years of education. However, it is certainly worth noting that Africa's urban mean years of education is still not to par with most other regions in the world, meaning Africa as a whole needs improvement in their education system.

Additionally, if we again break Africa down by region, we can see that Northern Africa once again has a higher mean years of education when compared to the Sub-Saharan African region. This suggests that rural areas **in** Sub-Saharan Africa. Another important metric that will be explored in the next section is benchmark test scores.

```{r}
#| label: north africa vs subsaharan africa mean_educ
#| echo: false

africa_mean_educ <- merged_data |>
  filter(sub_region %in% c('Northern Africa', 'Sub-Saharan Africa')) |>
  group_by(sub_region) |>
  summarise(
            mean_educ_years_20_24 = mean(eduyears_2024_m, na.rm = TRUE),
            ) |>
  ggplot(aes(x = sub_region, y = mean_educ_years_20_24, fill = sub_region)) +
  geom_col() + 
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

africa_mean_educ
```

### Section 1.4: Learning Achievment

In Section 1.1, we explored PISA scores around the world, but the UNESCO dataset also offers a benchmark standardized test that we can explore. There are three subjects (math, science, and reading), and there are 4 levels for each one, with each level getting increasingly difficult.

```{r}
#| label: test scores 1
#| echo: false

learning1 <- merged_data |>
  filter(year %in% c(2012,2013,2014,2015,2016,2017,2018)) |>
  group_by(region) |>
  summarise(
      math_level1 = mean(mlevel1_m, na.rm = TRUE),
      count = n()
  ) |>
  ggplot(aes(x = region, y = math_level1)) + geom_col() +ylim(c(0,1))

learning2 <- merged_data |>
  filter(year %in% c(2012,2013,2014,2015,2016,2017,2018)) |>
  group_by(region) |>
  summarise(
      math_level2 = mean(mlevel2_m, na.rm = TRUE),
      count = n()
  ) |>
  ggplot(aes(x = region, y = math_level2)) + geom_col()+ylim(c(0,1))


learning3 <- merged_data |>
  filter(year %in% c(2012,2013,2014,2015,2016,2017,2018)) |>
  group_by(region) |>
  summarise(
      math_level3 = mean(mlevel3_m, na.rm = TRUE),
      count = n()
  ) |>
  ggplot(aes(x = region, y = math_level3)) + geom_col()+ylim(c(0,1))


learning4 <- merged_data |>
  filter(year %in% c(2012,2013,2014,2015,2016,2017,2018)) |>
  group_by(region) |>
  summarise(
      math_level4 = mean(mlevel4_m, na.rm = TRUE),
      count = n()
  ) |>
  ggplot(aes(x = region, y = math_level4)) + geom_col()+ylim(c(0,1))

s <- learning1 + learning2 + learning3 + learning4

s
```

It is clear from these graphs that Oceania and Europe have the highest test scores while Africa and South Ameirca by far have the lowest test scores. It is completely expected for test scores to drop as the level gets harder and harder (level 1-4), but what is concerning is that in level 4, both Africa and South America are almost at an average of 0. In levels 1-3, both Africa and South America are at least some what on par with the other continents, but in the fourth level, they are signfiicantly lower than every other continent. This suggests that both Africa and South America's education gets worse when education gets to a higher level. This could be a key point of interest for these two continents.

```{r}
#| label: north africa vs subsaharan africa math score
#| echo: false

africa_mean_math <- merged_data |>
  filter(sub_region %in% c('Northern Africa', 'Sub-Saharan Africa')) |>
  group_by(sub_region) |>
  summarise(
            math = mean(mlevel4_m, na.rm = TRUE),
            ) |>
  ggplot(aes(x = sub_region, y = math, fill = sub_region)) +
  geom_col() +ylim(c(0,1))
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

africa_mean_math
```
```{r}
#| label: Latin America
#| echo: false

southamerica_mean_math <- merged_data2 |>
  filter(region %in% c('South America')) |>
  group_by(country) |>
  summarise(
            math = mean(mlevel4_m, na.rm = TRUE),
            ) |>
  ggplot(aes(x = country, y = math, fill = country)) +
  geom_col() +ylim(c(0,1))
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

southamerica_mean_math
```

These graphs give us a better breakdown as to why the scores appear the way they do. Opposite of what we have seen before, for passing the level 4 math test, it seems as though the region does not affect the continent's performance dramatically. This implies that Africa and South America need better higher education systems all over the continent and not just in particular regions.

### Section 1.5: College Attendance

Another important metric of education is the percentage of students who are and are not in school. Regardless of academic outcome (GPA, test scores, etc.) It is incredibly important that younger people are even attending school to begin with. UNESCO provides data on attendance rates for primary school, lower secondary school, and upper secondary school.

```{r}
#| label: per. of people not in prim school
#| echo: false

prim <- merged_data |>
  #filter(year %in% c(2014, 2015, 2016, 2017, 2018)) |>
  group_by(region) |>
  summarise(prim = mean(eduout_prim_m, na.rm = TRUE)) |>
  ggplot(aes(x = region, y = prim, fill = region)) +
    geom_col()+ ylim(c(0,1))
  labs(
    title = "Percentage of Young People Not in Primary School",
    subtitle = "This data only includes data on young people"
  )

prim
```

```{r}
#| label: per. of people not in lowsec school
#| echo: false

lowsec <- merged_data |>
  #filter(year %in% c(2014, 2015, 2016, 2017, 2018)) |>
  group_by(region) |>
  summarise(lowsec = mean(eduout_lowsec_m, na.rm = TRUE)) |>
  ggplot(aes(x = region, y = lowsec, fill = region)) +
    geom_col() + ylim(c(0,1))
  labs(
    title = "Percentage of YoungPeople Not in Lower Secondary School",
    subtitle = "This data only includes data on young people"
  )

lowsec
```

```{r}
#| label: per. of people not in upsec school
#| echo: false

upsec <- merged_data |>
  #filter(year %in% c(2014, 2015, 2016, 2017, 2018)) |>
  group_by(region) |>
  summarise(upsec = mean(eduout_upsec_m, na.rm = TRUE)) |>
  ggplot(aes(x = region, y = upsec, fill = region)) +
    geom_col() + ylim(c(0,1))
  labs(
    title = "Percentage of Young People Not in Upper Secondary School",
    subtitle = "This data only includes data on young people"
  )

upsec
```

As you can see, Africa has the highest percentage of not attending school for all three categories, and Europe has the lowest. A suprising result in this metric is how South America has the second lowest non-attendane rate which is a good thing. While they ranked lower in other metrics such as their test scores, it is clear that at the very least, South America ***is*** doing a good job getting their students to at least attend school. Let's breka this down further by looking at Rural vs. Urban areas.

```{r}
#| label: rural vs urban
#| echo: false

grouped7 <- merged_data |>
  group_by(region, Location) |>
  summarise(upsec = mean(eduout_upsec_m, na.rm = TRUE)) |>
  ggplot(
    aes(x = Location, y = upsec, fill = Location) 
  )+geom_col() +
  facet_wrap(~ region, scales = "free_x") 

grouped7
```

Similar to what we observed in section 1.3 the rural areas perform worse in this metric; however, it is worth noting that rural areas are performing even worse in this metric than the mean years of education section. For example, in North America and South America, the Rural non-attendance rate is almost half of non-attendance rate for urban areas. This implies that Rural areas need significantly more work than non-rural areas. Let's now break it down by gender.

```{r}
#| label: gender
#| echo: false

grouped7 <- merged_data |>
  group_by(region, Sex) |>
  summarise(upsec = mean(eduout_upsec_m, na.rm = TRUE)) |>
  ggplot(
    aes(x = Sex, y = upsec, fill = Sex) 
  ) +
  geom_col() +
  facet_wrap(~ region, scales = "free_x") 

grouped7
```

Explain gender...

```{r}
#| label: facet
#| echo: false

grouped7 <- merged_data |>
  group_by(region, iso_code) |>
  summarise(upsec = mean(eduout_upsec_m, na.rm = TRUE)) |>
  ggplot(
    aes(x = iso_code, y = upsec) 
  ) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 5)) +
  facet_wrap(~region, scales = "free_x")

grouped7
```

Explain countries

maybe add a top 5 countries in each region.

### Section 1.6: Top countries in each section

### Section 1.7: Section 1 Conclusion

### Section 2: Modeling

```{r}
#| label: model cleaning
#| echo: false

grouped2 <- data |>
  group_by(iso_code) |>
  summarise(mean_primary_completion_rate = mean(comp_prim_v2_m, na.rm = TRUE),
            mean_educ_years_20_24 = mean(eduyears_2024_m, na.rm = TRUE),
            attend_higher_education = mean(attend_higher_1822_m, na.rm = TRUE),
            count = n()) |>
  ungroup()
```


```{r}
#| label: linear model
#| echo: false

lm_model <- 
  linear_reg() |> 
  set_engine("lm")

lm_form_fit <- 
  lm_model %>% 
  fit(mean_primary_completion_rate ~ mean_educ_years_20_24, data = grouped2)

lm_form_fit
```

```{r}
#| label: model summary
#| echo: false

summary(lm_form_fit)
```

```{r}
#| label: model summary 2
#| echo: false

broom::glance(lm_form_fit)
broom::augment(lm_form_fit, new_data = grouped2)
```

```{r}
#| label: scatter plot
#| echo: false

ggplot(grouped2, aes(x = mean_educ_years_20_24, y=mean_primary_completion_rate)) + geom_point() + geom_smooth() + geom_smooth(method = 'lm', color = 'red')
```

```{r}
#| label: residual plot
#| echo: false

ggplot(broom::augment(lm_form_fit, new_data =grouped2), aes(x = .pred, y = .resid)) +    geom_point(alpha = 0.45, style = 'O', size = 2.5) + ylim(c(-1,1)) + geom_line(y = 0, color = 'red')
```

